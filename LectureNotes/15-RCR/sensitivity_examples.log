----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Admin\Dropbox\My PC (DESKTOP-9MD6Q97)\Documents\fall-2022\LectureNotes\15-RCR\sensitivity_examples.log
  log type:  text
 opened on:   9 Nov 2022, 16:26:56

. 
. /*
> THIS DO-FILE GOES THROUGH DIFFERENT EXAMPLES OF SENSITIVITY TOOLS
> IT IS REQUIRED TO FIRST INSTALL THREE PACKAGES:
> 
> 1. Krauth (2016) 
> net install rcr, from("http://www.sfu.ca/~bkrauth/code")
> 
> 2. Oster (2019) 
> ssc install psacalc
> 
> 3. Diegert, Masten & Poirier (2022)
> ssc install regsensitivity
> */
. 
. 
. * load the data
. use bfg2020, clear

. 
. * create dummies
. qui tab statea, gen(statea_d)

. 
. * define local macros
. local y avgrep2000to2016

. local d tye_tfe890_500kNI_100_l6

. local x1 log_area_2010 lat lon temp_mean rain_mean elev_mean d_coa d_riv d_lak ave_gyi

. local x0 statea_d*

. local x `x1' `x0'

. local SE cluster(km_grid_cel_code)

. 
. * OLS: "short" model
. reg `y' `d', `SE'

Linear regression                               Number of obs     =      2,036
                                                F(1, 379)         =      25.42
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0269
                                                Root MSE          =      11.52

                                 (Std. err. adjusted for 380 clusters in km_grid_cel_code)
------------------------------------------------------------------------------------------
                         |               Robust
        avgrep2000to2016 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------------------+----------------------------------------------------------------
tye_tfe890_500kNI_100_l6 |   1.707838   .3387321     5.04   0.000     1.041809    2.373868
                   _cons |   56.93096   .8342952    68.24   0.000     55.29054    58.57139
------------------------------------------------------------------------------------------

. 
. * OLS: "medium" model
. reg `y' `d' `x', `SE'
note: statea_d30 omitted because of collinearity.

Linear regression                               Number of obs     =      2,036
                                                F(39, 379)        =          .
                                                Prob > F          =          .
                                                R-squared         =     0.3321
                                                Root MSE          =     9.6368

                                 (Std. err. adjusted for 380 clusters in km_grid_cel_code)
------------------------------------------------------------------------------------------
                         |               Robust
        avgrep2000to2016 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------------------+----------------------------------------------------------------
tye_tfe890_500kNI_100_l6 |   2.054759   .3491648     5.88   0.000     1.368217    2.741302
           log_area_2010 |   .2758775    .979906     0.28   0.778    -1.650856    2.202611
                     lat |    2.26515   1.101151     2.06   0.040     .1000189    4.430281
                     lon |   .0108189   .2913783     0.04   0.970    -.5621017    .5837395
               temp_mean |    1.62737   1.068132     1.52   0.128    -.4728361    3.727577
               rain_mean |   .0164826   .0046086     3.58   0.000      .007421    .0255442
               elev_mean |   .0154764   .0037786     4.10   0.000     .0080468     .022906
                   d_coa |   9.83e-06   3.76e-06     2.62   0.009     2.45e-06    .0000172
                   d_riv |   .0000307   9.91e-06     3.10   0.002     .0000112    .0000502
                   d_lak |   3.05e-07   4.45e-06     0.07   0.945    -8.44e-06    9.05e-06
                 ave_gyi |  -3.779807   10.81002    -0.35   0.727    -25.03493    17.47532
               statea_d1 |   19.02288   9.729311     1.96   0.051    -.1073112    38.15307
               statea_d2 |   14.80933   9.037725     1.64   0.102    -2.961029     32.5797
               statea_d3 |  -8.293944   7.992948    -1.04   0.300    -24.01002    7.422133
               statea_d4 |   23.65047   10.37418     2.28   0.023     3.252314    44.04862
               statea_d5 |   19.56277   9.662194     2.02   0.044     .5645458    38.56099
               statea_d6 |   8.764654   9.189703     0.95   0.341    -9.304535    26.83384
               statea_d7 |   13.09843   9.350324     1.40   0.162    -5.286582    31.48343
               statea_d8 |   .9958279   8.973125     0.11   0.912    -16.64752    18.63917
               statea_d9 |   20.62162   8.317216     2.48   0.014     4.267951    36.97529
              statea_d10 |   18.51871   9.449585     1.96   0.051    -.0614696    37.09889
              statea_d11 |   19.91686   9.438246     2.11   0.035     1.358976    38.47474
              statea_d12 |    4.95974    9.53108     0.52   0.603    -13.78068    23.70016
              statea_d13 |   .9197979    8.72386     0.11   0.916    -16.23343    18.07303
              statea_d14 |   12.09196   9.536508     1.27   0.206    -6.659131    30.84305
              statea_d15 |   14.85254   8.958608     1.66   0.098    -2.762255    32.46734
              statea_d16 |   17.68026   8.274391     2.14   0.033     1.410799    33.94973
              statea_d17 |  -21.75719   10.14075    -2.15   0.033    -41.69637   -1.818017
              statea_d18 |   9.201229   10.39555     0.89   0.377    -11.23894     29.6414
              statea_d19 |   5.485318   9.882896     0.56   0.579    -13.94686    24.91749
              statea_d20 |   7.040953   8.724868     0.81   0.420    -10.11426    24.19616
              statea_d21 |   12.83207   9.537529     1.35   0.179     -5.92103    31.58517
              statea_d22 |   32.62317   8.817284     3.70   0.000     15.28624    49.96009
              statea_d23 |   15.87665    10.1771     1.56   0.120    -4.133997    35.88729
              statea_d24 |   7.175823   8.460954     0.85   0.397    -9.460469    23.81211
              statea_d25 |   15.48143   9.403522     1.65   0.101    -3.008176    33.97104
              statea_d26 |   31.84879   9.018887     3.53   0.000     14.11546    49.58211
              statea_d27 |   18.21119   9.733384     1.87   0.062     -.927009    37.34939
              statea_d28 |    15.7793   9.711617     1.62   0.105    -3.316103     34.8747
              statea_d29 |   .0936985   8.997946     0.01   0.992    -17.59845    17.78585
              statea_d30 |          0  (omitted)
                   _cons |  -92.55811   60.33668    -1.53   0.126    -211.1947    26.07847
------------------------------------------------------------------------------------------

. 
. * Krauth
. //rcr `y' `d' `x', lambda(0 0.1) cluster(km_grid_cel_code)
. 
. * Oster
. qui reg `y' `d' `x', `SE'

. psacalc beta `d', delta(0) // returns "medium" OLS result

                 ---- Treatment Effect Estimate ----
             |     Estimate           Sq. difference      Bias changes
             |                      from controlled beta    direction
-------------+----------------------------------------------------------------
Beta         |       2.05476                    .             
Alt. sol. 1  |             .                    .             
Alt. sol. 2  |             .                    .             
-------------+----------------------------------------------------------------

                 ---- Inputs from Regressions ----
             |      Coeff.            R-Squared
-------------+----------------------------------------------------------------
Uncontrolled |        1.70784         0.027
Controlled   |        2.05476         0.332
-------------+----------------------------------------------------------------

                 ---- Other Inputs ----
-------------+----------------------------------------------------------------
R_max        |   1.000
Delta        |   0.000
Unr. Controls|   
-------------+----------------------------------------------------------------

. psacalc beta `d'           // returns an estimate of coeff. of interest ("beta") when ratio of sel. on obs. รท sel. on unobs. ("delta") is equal to 1

                 ---- Treatment Effect Estimate ----
             |     Estimate           Sq. difference      Bias changes
             |                      from controlled beta    direction
-------------+----------------------------------------------------------------
Beta         |       9.29321                 52.4             
Alt. sol. 1  |     -12.20026                  203             Yes
Alt. sol. 2  |                                                
-------------+----------------------------------------------------------------

                 ---- Inputs from Regressions ----
             |      Coeff.            R-Squared
-------------+----------------------------------------------------------------
Uncontrolled |        1.70784         0.027
Controlled   |        2.05476         0.332
-------------+----------------------------------------------------------------

                 ---- Other Inputs ----
-------------+----------------------------------------------------------------
R_max        |   1.000
Delta        |   1.000
Unr. Controls|   
-------------+----------------------------------------------------------------

. psacalc delta `d', beta(0) rmax(0.7) // reports ratio of sel. on obs. รท sel. on unobs. ("delta") such that coeff. of interest ("beta") is equal to 0

                 ---- Bound Estimate ----
-------------+----------------------------------------------------------------
delta        |       4.18119
-------------+----------------------------------------------------------------

                 ---- Inputs from Regressions ----
             |      Coeff.                      R-Squared
-------------+----------------------------------------------------------------
Uncontrolled |        1.70784                   0.027
Controlled   |        2.05476                   0.332
-------------+----------------------------------------------------------------

                 ---- Other Inputs ----
-------------+----------------------------------------------------------------
R_max        |   0.700
Beta         |    0.000000
Unr. Controls|   
-------------+----------------------------------------------------------------

. 
. * Diegert et al.
. regsensitivity `y' `d' `x', compare(`x1')


Regression Sensitivity Analysis, Bounds

Analysis         : DMP (2022)                  Number of obs      =       2,036
                                               Beta(short)        =       1.925
Treatment        : tye_tfe890_500kNI_100_l6    Beta(medium)       =       2.055
Outcome          : avgrep2000to2016            R2(short)          =       0.033
                                               R2(medium)         =       0.105
                                               Var(Y)             =     101.739
                                               Var(X)             =       0.901
                                               Var(X_Residual)    =       0.882

Hypothesis       : Beta > 0                    Breakdown point    =        80.4%
Other Params     : cbar = 1, rybar = +inf

--------------------------------------------------------------------------------
 rxbar                             Beta
--------------------------------------------------------------------------------
 0.000                            [ 2.0548,  2.0548 ]
 0.100                            [ 1.9042,  2.2053 ]
 0.201                            [ 1.7488,  2.3607 ]
 0.301                            [ 1.5830,  2.5266 ]
 0.402                            [ 1.3991,  2.7104 ]
 0.502                            [ 1.1855,  2.9240 ]
 0.602                            [ 0.9216,  3.1879 ]
 0.703                            [ 0.5647,  3.5448 ]
 0.803                            [ 0.0018,  4.1077 ]
 0.904                            [-1.2579,  5.3675 ]
 0.989                            [   -inf,    +inf ]
--------------------------------------------------------------------------------

Regression Sensitivity Analysis, Breakdown Frontier

Analysis         : Oster (2019)
Treatment        : tye_tfe890_500kNI_100_l6
Outcome          : avgrep2000to2016
Hypothesis       : Beta != 0         

--------------------------------------------------------------------------------
 R-squared(long)                    Delta(Breakdown)
--------------------------------------------------------------------------------
 0.137                              2328.8%
 1.000                              170.4%
--------------------------------------------------------------------------------

. regsensitivity bounds `y' `d' `x', compare(`x1')

Regression Sensitivity Analysis, Bounds

Analysis         : DMP (2022)                  Number of obs      =       2,036
                                               Beta(short)        =       1.925
Treatment        : tye_tfe890_500kNI_100_l6    Beta(medium)       =       2.055
Outcome          : avgrep2000to2016            R2(short)          =       0.033
                                               R2(medium)         =       0.105
                                               Var(Y)             =     101.739
                                               Var(X)             =       0.901
                                               Var(X_Residual)    =       0.882

Hypothesis       : Beta > 0                    Breakdown point    =        80.4%
Other Params     : cbar = 1, rybar = +inf

--------------------------------------------------------------------------------
 rxbar                             Beta
--------------------------------------------------------------------------------
 0.000                            [ 2.0548,  2.0548 ]
 0.100                            [ 1.9042,  2.2053 ]
 0.201                            [ 1.7488,  2.3607 ]
 0.301                            [ 1.5830,  2.5266 ]
 0.402                            [ 1.3991,  2.7104 ]
 0.502                            [ 1.1855,  2.9240 ]
 0.602                            [ 0.9216,  3.1879 ]
 0.703                            [ 0.5647,  3.5448 ]
 0.803                            [ 0.0018,  4.1077 ]
 0.904                            [-1.2579,  5.3675 ]
 0.989                            [   -inf,    +inf ]
--------------------------------------------------------------------------------

. 
end of do-file

